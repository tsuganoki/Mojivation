"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var createContext=_interopDefault(require("create-react-context"));require("warning");var React=_interopDefault(require("react")),PropTypes=_interopDefault(require("prop-types")),history=require("history"),invariant=_interopDefault(require("invariant")),pathToRegexp=_interopDefault(require("path-to-regexp")),hoistStatics=_interopDefault(require("hoist-non-react-statics")),context=createContext();context.Provider.displayName="Router.Provider",context.Consumer.displayName="Router.Consumer";var classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},objectWithoutProperties=function(t,e){var n={};for(var o in t)0<=e.indexOf(o)||Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};function getContext(t,e){return{history:t.history,location:e.location,match:Router.computeRootMatch(e.location.pathname),staticContext:t.staticContext}}var Router=function(n){function o(t){classCallCheck(this,o);var e=possibleConstructorReturn(this,n.call(this,t));return e.state={location:t.history.location},e._isMounted=!1,e._pendingLocation=null,t.staticContext||(e.unlisten=t.history.listen(function(t){e._isMounted?e.setState({location:t}):e._pendingLocation=t})),e}return inherits(o,n),o.computeRootMatch=function(t){return{path:"/",url:"/",params:{},isExact:"/"===t}},o.prototype.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},o.prototype.componentWillUnmount=function(){this.unlisten&&this.unlisten()},o.prototype.render=function(){var t=getContext(this.props,this.state);return React.createElement(context.Provider,{children:this.props.children||null,value:t})},o}(React.Component);React.createContext||(Router.childContextTypes={router:PropTypes.object.isRequired},Router.prototype.getChildContext=function(){return{router:getContext(this.props,this.state)}});var MemoryRouter=function(a){function i(){var t,e;classCallCheck(this,i);for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e=possibleConstructorReturn(this,a.call.apply(a,[this].concat(o)))).history=history.createMemoryHistory(e.props),possibleConstructorReturn(e,t)}return inherits(i,a),i.prototype.render=function(){return React.createElement(Router,{history:this.history,children:this.props.children})},i}(React.Component),Lifecycle=function(t){function e(){return classCallCheck(this,e),possibleConstructorReturn(this,t.apply(this,arguments))}return inherits(e,t),e.prototype.componentDidMount=function(){this.props.onMount&&this.props.onMount.call(this,this)},e.prototype.componentDidUpdate=function(t){this.props.onUpdate&&this.props.onUpdate.call(this,this,t)},e.prototype.componentWillUnmount=function(){this.props.onUnmount&&this.props.onUnmount.call(this,this)},e.prototype.render=function(){return null},e}(React.Component);function Prompt(e){return React.createElement(context.Consumer,null,function(t){if(t||invariant(!1),!e.when||t.staticContext)return null;var n=t.history.block,o=e.message;return React.createElement(Lifecycle,{onMount:function(t){t.release=n(o)},onUpdate:function(t,e){e.message!==o&&(t.release(),t.release=n(o))},onUnmount:function(t){t.release()}})})}Prompt.defaultProps={when:!0};var cache={},cacheLimit=1e4,cacheCount=0;function compilePath(t){if(cache[t])return cache[t];var e=pathToRegexp.compile(t);return cacheCount<cacheLimit&&(cache[t]=e,cacheCount++),e}function generatePath(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"/",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return"/"===t?t:compilePath(t)(e,{pretty:!0})}function Redirect(e){return React.createElement(context.Consumer,null,function(t){t||invariant(!1);var n=e.push?t.history.push:t.history.replace,o=history.createLocation(e.computedMatch?"string"==typeof e.to?generatePath(e.to,e.computedMatch.params):Object.assign({},e.to,{pathname:generatePath(e.to.pathname,e.computedMatch.params)}):e.to);return t.staticContext?(n(o),null):React.createElement(Lifecycle,{onMount:function(){n(o)},onUpdate:function(t,e){history.locationsAreEqual(e.to,o)||n(o)},to:o})})}Redirect.defaultProps={push:!1};var cache$1={},cacheLimit$1=1e4,cacheCount$1=0;function compilePath$1(t,e){var n=""+e.end+e.strict+e.sensitive,o=cache$1[n]||(cache$1[n]={});if(o[t])return o[t];var r=[],a={regexp:pathToRegexp(t,r,e),keys:r};return cacheCount$1<cacheLimit$1&&(o[t]=a,cacheCount$1++),a}function matchPath(u){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};"string"==typeof t&&(t={path:t});var e=t,n=e.path,o=e.exact,p=void 0!==o&&o,r=e.strict,l=void 0!==r&&r,a=e.sensitive,h=void 0!==a&&a;return[].concat(n).reduce(function(t,e){if(t)return t;var n=compilePath$1(e,{end:p,strict:l,sensitive:h}),o=n.regexp,r=n.keys,a=o.exec(u);if(!a)return null;var i=a[0],c=a.slice(1),s=u===i;return p&&!s?null:{path:e,url:"/"===e&&""===i?"/":i,isExact:s,params:r.reduce(function(t,e,n){return t[e.name]=c[n],t},{})}},null)}function isEmptyChildren(t){return 0===React.Children.count(t)}function getContext$1(t,e){var n=t.location||e.location,o=t.computedMatch?t.computedMatch:t.path?matchPath(n.pathname,t):e.match;return Object.assign({},e,{location:n,match:o})}var Route=function(t){function e(){return classCallCheck(this,e),possibleConstructorReturn(this,t.apply(this,arguments))}return inherits(e,t),e.prototype.render=function(){var i=this;return React.createElement(context.Consumer,null,function(t){t||invariant(!1);var e=getContext$1(i.props,t),n=i.props,o=n.children,r=n.component,a=n.render;return Array.isArray(o)&&0===o.length&&(o=null),"function"==typeof o&&void 0===(o=o(e))&&(o=null),React.createElement(context.Provider,{value:e},o&&!isEmptyChildren(o)?o:e.match?r?React.createElement(r,e):a?a(e):null:null)})},e}(React.Component);function addLeadingSlash(t){return"/"===t.charAt(0)?t:"/"+t}function addBasename(t,e){return t?Object.assign({},e,{pathname:addLeadingSlash(t)+e.pathname}):e}function stripBasename(t,e){if(!t)return e;var n=addLeadingSlash(t);return 0!==e.pathname.indexOf(n)?e:Object.assign({},e,{pathname:e.pathname.substr(n.length)})}function createURL(t){return"string"==typeof t?t:history.createPath(t)}function staticHandler(t){return function(){invariant(!1)}}function noop(){}React.createContext||(Route.contextTypes={router:PropTypes.object.isRequired},Route.childContextTypes={router:PropTypes.object.isRequired},Route.prototype.getChildContext=function(){this.context.router||invariant(!1);var t=this.context.router;return{router:getContext$1(this.props,t)}});var StaticRouter=function(a){function i(){var t,r;classCallCheck(this,i);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=r=possibleConstructorReturn(this,a.call.apply(a,[this].concat(n)))).createHref=function(t){return addLeadingSlash(r.props.basename+createURL(t))},r.handlePush=function(t){var e=r.props,n=e.basename,o=e.context;o.action="PUSH",o.location=addBasename(n,history.createLocation(t)),o.url=createURL(o.location)},r.handleReplace=function(t){var e=r.props,n=e.basename,o=e.context;o.action="REPLACE",o.location=addBasename(n,history.createLocation(t)),o.url=createURL(o.location)},r.handleListen=function(){return noop},r.handleBlock=function(){return noop},possibleConstructorReturn(r,t)}return inherits(i,a),i.prototype.render=function(){var t=this.props,e=t.basename,n=(t.context,t.location),o=objectWithoutProperties(t,["basename","context","location"]),r={createHref:this.createHref,action:"POP",location:stripBasename(e,history.createLocation(n)),push:this.handlePush,replace:this.handleReplace,go:staticHandler("go"),goBack:staticHandler("goBack"),goForward:staticHandler("goForward"),listen:this.handleListen,block:this.handleBlock};return React.createElement(Router,_extends({},o,{history:r,staticContext:this.props.context||{}}))},i}(React.Component);StaticRouter.defaultProps={basename:"",location:"/"};var Switch=function(t){function e(){return classCallCheck(this,e),possibleConstructorReturn(this,t.apply(this,arguments))}return inherits(e,t),e.prototype.render=function(){var t=this;return React.createElement(context.Consumer,null,function(n){n||invariant(!1);var o=t.props.location||n.location,r=void 0,a=void 0;return React.Children.forEach(t.props.children,function(t){if(null==a&&React.isValidElement(t)){var e=(r=t).props.path||t.props.from;a=e?matchPath(o.pathname,Object.assign({},t.props,{path:e})):n.match}}),a?React.cloneElement(r,{location:o,computedMatch:a}):null})},e}(React.Component);function withRouter(o){var t=function(t){var e=t.wrappedComponentRef,n=objectWithoutProperties(t,["wrappedComponentRef"]);return React.createElement(Route,{children:function(t){return React.createElement(o,_extends({},n,t,{ref:e}))}})};return t.displayName="withRouter("+(o.displayName||o.name)+")",t.WrappedComponent=o,hoistStatics(t,o)}exports.MemoryRouter=MemoryRouter,exports.Prompt=Prompt,exports.Redirect=Redirect,exports.Route=Route,exports.Router=Router,exports.StaticRouter=StaticRouter,exports.Switch=Switch,exports.generatePath=generatePath,exports.matchPath=matchPath,exports.withRouter=withRouter,exports.__RouterContext=context;
